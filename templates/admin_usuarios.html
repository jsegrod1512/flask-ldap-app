{% extends "base.html" %}
{% block title %}Gestión de Usuarios{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-10 offset-md-1">
    <h3>Administración de Usuarios de la App</h3>
    <table class="table table-bordered mt-4">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol Actual</th>
          <th>Fecha Alta</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.username }}</td>
          <td>{{ u.role_id }}</td>
          <td>{{ u.created_at }}</td>
          <td>
            <!-- Cambiar rol -->
            <form method="post" class="d-inline">
              <input type="hidden" name="action" value="change_role">
              <input type="hidden" name="username" value="{{ u.username }}">
              <select name="role_id" class="form-select d-inline w-auto">
                {% for val, label in role_choices %}
                  <option value="{{ val }}" {% if u.role_id == val %}selected{% endif %}>
                    {{ label }}
                  </option>
                {% endfor %}
              </select>
              <button class="btn btn-sm btn-primary">Actualizar</button>
            </form>
            <!-- Eliminar usuario -->
            <form method="post" class="d-inline ms-2">
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="username" value="{{ u.username }}">
              <button class="btn btn-sm btn-danger" onclick="return confirm('Eliminar {{ u.username }}?')">
                Eliminar
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
